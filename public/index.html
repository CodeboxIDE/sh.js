<html>
    <head>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script type="text/javascript" src="/sh.js"></script>
    </head>
    <body>
        <div class="terminal-0 terminal-panel"></div>
        <div class="terminal-1 terminal-panel"></div>
        <script>
        var openTerminal = function(el) {
            var term = new Terminal({
                theme: "desert",
                cols: 80,
                rows: 24
            });
            term.open($(el).get(0));

            term.sizeToFit();

            var socket = io.connect([window.location.protocol, '//', window.location.host].join(''), {
                'force new connection': true
            });
            socket.on('connect', function() {
                socket.emit("resize", {
                    'w': term.cols,
                    'h': term.rows
                });
            });
            socket.on('output', function (data) {
                term.write(data.content);
            });

            term.on("data", function (c) {
                socket.emit('input', { content: c });
            });

            term.on("resize", function (c, k) {
                socket.emit("resize", {
                    'w': c,
                    'h': k
                });
            });

            window.onresize = function () {
                return term.sizeToFit();
            };

            /*$(window).focus(function () {
                return term.focus()
            });*/
            $(el).on("touchstart", function (c) {
                return term.focus()
            });
            $(el).on("touchend", function () {
                return term.focus()
            });
            term.element.focus();
        }

        $(document).ready(function() {
            openTerminal(".terminal-0");
            openTerminal(".terminal-1");
        });
        </script>
    </body>
</html>